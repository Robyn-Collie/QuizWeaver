{% extends "base.html" %}
{% block title %}Generate Quiz - {{ class_obj.name }} - QuizWeaver{% endblock %}

{% block content %}
<h1>Generate Quiz - {{ class_obj.name }}</h1>

{% if error %}
<div class="alert alert-error">{{ error }}</div>
{% endif %}

<form method="POST" action="/classes/{{ class_obj.id }}/generate" class="form">
    <div class="form-group">
        <label for="num_questions">Number of Questions <span class="help-tip" data-tip="Number of questions to generate (1-50). Default is 20.">?</span></label>
        <input type="number" id="num_questions" name="num_questions" value="20" min="1" max="50" required>
    </div>
    <div class="form-group">
        <label for="grade_level">Grade Level <span class="help-tip" data-tip="Used to calibrate quiz difficulty and vocabulary level">?</span></label>
        <input type="text" id="grade_level" name="grade_level" value="{{ class_obj.grade_level or '' }}" placeholder="e.g., 7th Grade">
    </div>
    <div class="form-group">
        <label for="sol_standards">SOL Standards (optional) <span class="help-tip" data-tip="Comma-separated list of SOL standards to target in quiz questions">?</span></label>
        <input type="text" id="sol_standards" name="sol_standards" placeholder="e.g., SOL 7.1, SOL 7.2">
    </div>
    <div class="form-group">
        <label>Cognitive Framework</label>
        <div class="radio-group">
            <label><input type="radio" name="cognitive_framework_radio" value="" checked> None</label>
            <label><input type="radio" name="cognitive_framework_radio" value="blooms"> Bloom's Taxonomy</label>
            <label><input type="radio" name="cognitive_framework_radio" value="dok"> Webb's DOK</label>
        </div>
        <input type="hidden" id="cognitive_framework" name="cognitive_framework" value="">
    </div>

    <div class="form-group" id="cognitive-distribution-group" style="display:none">
        <label>Question Distribution by Level</label>
        <table class="cognitive-table" id="cognitive-table">
            <thead>
                <tr>
                    <th>Level</th>
                    <th>Count</th>
                    <th>Question Types</th>
                </tr>
            </thead>
            <tbody></tbody>
            <tfoot>
                <tr>
                    <td><strong>Total</strong></td>
                    <td class="cognitive-total"><span id="cognitive-total">0</span> / <span id="cognitive-target">20</span></td>
                    <td><span class="validation-msg" id="validation-msg"></span></td>
                </tr>
            </tfoot>
        </table>
        <input type="hidden" id="cognitive_distribution" name="cognitive_distribution" value="">
    </div>

    <div class="form-group">
        <label for="difficulty">Difficulty Level</label>
        <input type="range" id="difficulty" name="difficulty" min="1" max="5" value="3">
        <span id="difficulty-label">3 - Moderate</span>
    </div>

    {% if providers is defined and providers %}
    <div class="form-group">
        <label for="provider">AI Provider <span class="help-tip" data-tip="Choose which AI model generates this quiz. Default uses your global setting from Settings page.">?</span></label>
        <select id="provider" name="provider">
            <option value="">Use default ({{ current_provider|default('mock') }})</option>
            {% for p in providers %}
            <option value="{{ p.key }}" {% if not p.available %}disabled{% endif %}>
                {{ p.label }}{% if not p.available %} (not configured){% endif %}
            </option>
            {% endfor %}
        </select>
    </div>
    {% endif %}

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">Generate Quiz</button>
        <a href="/classes/{{ class_obj.id }}" class="btn btn-secondary">Cancel</a>
    </div>
</form>
<script src="/static/js/cognitive_form.js"></script>
{% endblock %}
