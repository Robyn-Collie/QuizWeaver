{% extends "base.html" %}
{% block title %}{{ quiz.title }} - QuizWeaver{% endblock %}

{% block content %}
<h1>{{ quiz.title }}</h1>

<div class="quiz-info">
    <p><strong>Status:</strong> <span class="status status-{{ quiz.status }}">{{ quiz.status }}</span></p>
    {% if class_obj %}<p><strong>Class:</strong> <a href="/classes/{{ class_obj.id }}">{{ class_obj.name }}</a></p>{% endif %}
    <p><strong>Questions:</strong> {{ questions | length }}</p>
    {% if style_profile and style_profile.cognitive_framework is defined and style_profile.cognitive_framework %}
    <p><strong>Framework:</strong> {{ style_profile.cognitive_framework|capitalize }}</p>
    {% endif %}
    {% if style_profile and style_profile.difficulty is defined and style_profile.difficulty %}
    <p><strong>Difficulty:</strong> {{ style_profile.difficulty }}/5</p>
    {% endif %}
</div>

<h2>Questions</h2>
{% for q in questions %}
<div class="question-card">
    <div class="question-header">
        <span class="question-number">Q{{ loop.index }}</span>
        <span class="question-type">{{ q.type or 'unknown' }}</span>
        <span class="question-points">{{ q.points or 0 }} pts</span>
        {% if q.data and q.data.cognitive_level is defined and q.data.cognitive_level %}
        <span class="cognitive-badge cognitive-badge-{{ q.data.cognitive_level_number|default(0) }}">
            {{ q.data.cognitive_level }}
        </span>
        {% endif %}
    </div>
    <p class="question-text">{{ q.text }}</p>

    {% if q.data and q.data.image_ref is defined and q.data.image_ref %}
    <img src="/generated_images/{{ q.data.image_ref }}" alt="Question image" class="question-image">
    {% endif %}

    {% if q.data and q.data.options is defined %}
    <ul class="question-options">
        {% for option in q.data.options %}
        {% if option is mapping %}
        <li{% if q.data.correct_answers is defined and option.id in q.data.correct_answers %} class="correct"{% endif %}>
            <strong>{{ option.id }}.</strong> {{ option.text }}
        </li>
        {% else %}
        <li{% if q.data.correct_index is defined and loop.index0 == q.data.correct_index %} class="correct"{% endif %}>
            {{ option }}
        </li>
        {% endif %}
        {% endfor %}
    </ul>
    {% endif %}
</div>
{% endfor %}

<p><a href="/quizzes">&larr; Back to Quizzes</a></p>
{% endblock %}
