{% extends "base.html" %}
{% block title %}Import Performance Data - {{ class_obj.name }} - QuizWeaver{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Import Performance Data</h1>
    <a href="/classes/{{ class_obj.id }}/analytics" class="btn btn-secondary">Back to Analytics</a>
</div>

<p class="info-box">
    Upload a CSV file with performance data for <strong>{{ class_obj.name }}</strong>.
    <a href="/classes/{{ class_obj.id }}/analytics/sample-csv">Download sample CSV template</a>
</p>

{% if error %}
<div class="alert alert-error">{{ error }}</div>
{% endif %}

{% if errors %}
<div class="alert alert-warning">
    <strong>Some rows had errors:</strong>
    <ul>
        {% for err in errors %}
        <li>{{ err }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<form method="POST" enctype="multipart/form-data" class="form">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
    <div class="form-group">
        <label for="csv_file">CSV File</label>
        <input type="file" id="csv_file" name="csv_file" accept=".csv,text/csv">
        <small class="text-muted">
            Required columns: topic, score (0-100).
            Optional: date (YYYY-MM-DD), standard, weak_areas (semicolon-separated), sample_size.
        </small>
    </div>

    <div class="form-group">
        <label for="quiz_id">Link to Quiz (optional)</label>
        <select id="quiz_id" name="quiz_id">
            <option value="">-- No quiz --</option>
            {% for q in quizzes %}
            <option value="{{ q.id }}">{{ q.title or "Quiz #" ~ q.id }} ({{ q.questions|length }} Qs{% if q.created_at %} | {{ q.created_at.strftime('%b %d') }}{% endif %})</option>
            {% endfor %}
        </select>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">Upload & Import</button>
        <a href="/classes/{{ class_obj.id }}/analytics" class="btn btn-secondary">Cancel</a>
    </div>
</form>
{% endblock %}
